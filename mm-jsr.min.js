class JSRange{constructor(t,e,i){this._buffer={update:this._update,events:this._events},this.inputMin=document.querySelector(t),i.single?this.inputMax=this.inputMin:this.inputMax=document.querySelector(e),this.options={},this.options.min=i.min||parseFloat(this.inputMin.getAttribute("min")),this.options.max=i.max||parseFloat(this.inputMin.getAttribute("max")),this.options.step=i.step||parseFloat(this.inputMin.getAttribute("step")),this.options.single=i.single||!1,this.options.value=i.value||parseFloat(this.inputMin.getAttribute("value")),this.options.stepDecimals=this._calculateDecimals(this.options.step),this.options.prefixes=i.prefixes||{},this.options.suffixes=i.suffixes||{},this.meta={},this.meta.moveObject=null,this.meta.clientX=null,this.meta.clickX=null,this.meta.distanceFromValue=null,this.meta.throttle={},this.meta.twentiethRange=this._roundToStep((this.options.max-this.options.min)/20),this.selected={},this.options.single?this.selected.single=this.selected.from=this.selected.to=this.options.value:(this.selected.from=parseFloat(this.inputMin.getAttribute("value"))||this.options.min,this.selected.to=parseFloat(this.inputMax.getAttribute("value"))||this.options.max,this.selected.single=this.selected.from),this._createBody(),this._bindEvents(),this.update()}update(){this._update.all()}set(t={}){t.from&&(this.selected.from=t.from),t.to&&(this.selected.to=t.to),this.update()}_createBody(){this.inputMin.style.display="none",this.inputMax.style.display="none",this.body={},this.body.parent=document.createElement("div"),this.body.parent.classList.add("jsr"),this.body.parent.setAttribute("aria-live","assertive"),this.body.rail=document.createElement("div"),this.body.rail.classList.add("jsr_rail"),this.body.sliders={},this.body.sliders.from=document.createElement("div"),this.body.sliders.from.classList.add("jsr_slider","jsr_slider--from"),this.body.sliders.from.dataset.jsrType="from",this.body.sliders.to=document.createElement("div"),this.body.sliders.to.classList.add("jsr_slider","jsr_slider--to"),this.body.sliders.to.dataset.jsrType="to",this.body.sliders.to.setAttribute("tabindex","0"),this.options.single||this.body.sliders.from.setAttribute("tabindex","0"),this.body.info={},this.body.info.min=document.createElement("span"),this.body.info.min.classList.add("jsr_info","jsr_info--min"),this.body.info.min.dataset.jsrType="min",this.body.info.max=document.createElement("span"),this.body.info.max.classList.add("jsr_info","jsr_info--max"),this.body.info.max.dataset.jsrType="max",this.body.info.from=document.createElement("span"),this.body.info.from.classList.add("jsr_info","jsr_info--from"),this.body.info.from.dataset.jsrType="from",this.body.info.to=document.createElement("span"),this.body.info.to.classList.add("jsr_info","jsr_info--to"),this.body.info.to.dataset.jsrType="to",this.body.info.single=document.createElement("span"),this.body.info.single.classList.add("jsr_info","jsr_info--single"),this.body.info.singleFrom=document.createElement("span"),this.body.info.singleFrom.classList.add("jsr_info_singleFrom"),this.body.info.singleFrom.dataset.jsrType="from",this.body.info.singleTo=document.createElement("span"),this.body.info.singleTo.classList.add("jsr_info_singleTo"),this.body.info.singleTo.dataset.jsrType="to",this.body.info.singleSingle=document.createElement("span"),this.body.info.singleSingle.classList.add("jsr_info_singleSingle"),this.body.info.singleSingle.dataset.jsrType="single",this.body.info.singleSingle.style.display="none",this.body.info.single.appendChild(this.body.info.singleFrom),this.body.info.single.appendChild(this.body.info.singleTo),this.body.info.single.appendChild(this.body.info.singleSingle),[this.body.rail,this.body.sliders.from,this.body.sliders.to,this.body.info.min,this.body.info.max,this.body.info.from,this.body.info.to,this.body.info.single].forEach(t=>{this.body.parent.appendChild(t)}),this.inputMax.parentNode.insertBefore(this.body.parent,this.inputMax.nextSibling)}_bindEvents(){[this.body.sliders.from,this.body.sliders.to,this.body.info.from,this.body.info.to,this.body.info.singleFrom,this.body.info.singleTo,this.body.info.min,this.body.info.max,this.body.info.single].forEach(t=>{t.addEventListener("mousedown",this._events.sliderMouseDown);t.addEventListener("touchstart",this._events.touchStart);t.addEventListener("touchmove",this._events.touchMove)}),this.body.parent.addEventListener("keydown",this._events.keydown),window.addEventListener("resize",this._events.windowResize),document.addEventListener("mousemove",this._events.sliderMouseMove),document.addEventListener("mouseup",this._events.sliderMouseUp),this.body.rail.addEventListener("click",this._events.railClick)}_calculateDecimals(t){let e=t.toString().split(".");return e[1]?e[1].length:0}_getStringWithDecimals(t){let e=this._calculateDecimals(t),i=this._calculateDecimals(this.options.step),s=t.toString().split(".");s[1]=s[1]||"";let o=Array(i-e+1).join("0");return s[0]+(s[1].length+o.length>0?".":"")+s[1]+o}_getValueOfPosition(t){let e=t-this.body.rail.getBoundingClientRect().left;return parseFloat(e/this.body.rail.offsetWidth*(this.options.max-this.options.min)+this.options.min)}_roundToStep(t){t=Math.round(t/this.options.step)*this.options.step;let e=Math.pow(10,this.options.stepDecimals);return Math.round(t*e)/e}_getLeftOf(t){let e=parseFloat(this.body.rail.getBoundingClientRect().left);return(parseFloat(t.getBoundingClientRect().left)-e)/parseFloat(this.body.rail.offsetWidth)}_getRightOf(t){return this._getLeftOf(t)+this._getWidthOf(t)}_getCenterOf(t){return this._getLeftOf(t)+this._getWidthOf(t)/2}_getWidthOf(t){return parseFloat(t.offsetWidth)/parseFloat(this.body.rail.offsetWidth)}_solveMove(t,e,i,s,o=null){(e-=i)<this.options.min&&(e=this.options.min),e>this.options.max&&(e=this.options.max),"from"==t?this.selected.from=e<this.selected.to?e:this.selected.to:"to"==t?this.selected.to=e>this.selected.from?e:this.selected.from:"single"==t&&(o||(o=s-this.meta.clickX),o<0?(this.selected.from=e,this.meta.moveObject=this.body.info.from):o>0&&(this.selected.to=e,this.meta.moveObject=this.body.info.to)),this.selected.from=this._roundToStep(this.selected.from),this.selected.to=this._roundToStep(this.selected.to),this.options.single&&(this.selected.from=this.selected.to=this._roundToStep(e))}get _events(){var t=this;return t._buffer&&t._buffer.events?t._buffer.events:{windowResize:function(e){t._throttle("windowResize",50)&&t.update()},touchStart:function(e){e.preventDefault(),t._events.sliderMouseDown(e.targetTouches.item(0))},sliderMouseDown:function(e){let i=e.target.dataset.jsrType,s="single"==i?t.selected.from:t.selected[i];if(t.meta.distanceFromValue=t._getValueOfPosition(e.clientX)-s,i){if("min"==i)t.selected.from=t.options.min,t.options.single&&(t.selected.to=t.selected.from);else{if("max"!=i)return t.meta.moveObject=e.target,void(t.meta.clickX=e.clientX);t.selected.to=t.options.max,t.options.single&&(t.selected.from=t.selected.to)}t.update()}},sliderMouseUp:function(e){t.meta.moveObject=null,t.meta.clickX=null,t.meta.distanceFromValue=null},touchMove:function(e){e.preventDefault(),t._events.sliderMouseMove(e.targetTouches.item(0))},sliderMouseMove:function(e){if(e.preventDefault(),t.meta.moveObject&&t._throttle("mousemove",20)){let i=t.meta.moveObject.dataset.jsrType,s=t._getValueOfPosition(e.clientX);t._solveMove(i,s,t.meta.distanceFromValue,e.clientX),t.update()}},railClick:function(e){let i=t._getValueOfPosition(e.clientX);(i=t._roundToStep(i))<(t.selected.from+t.selected.to)/2?(t.selected.from=i,t.options.single&&(t.selected.to=t.selected.from)):(t.selected.to=i,t.options.single&&(t.selected.from=t.selected.to)),t.update()},keydown:function(e){e.preventDefault();let i,s=e.target.dataset.jsrType,o={left:37,right:39},n=t.selected[s],d=e.shiftKey?t.meta.twentiethRange:e.ctrlKey?10*t.options.step:t.options.step;if(e.keyCode==o.left)n-=d,i=-1;else{if(e.keyCode!=o.right)return!1;n+=d,i=1}t._solveMove(s,n,0,0,i),t.update()}}}get _update(){var t=this;return t._buffer&&t._buffer.update?t._buffer.update:{_toUpdate:["rail","sliders","info","values"],all:function(){this._toUpdate.forEach(t=>{this[t]()})},rail:function(){let e=(t.selected.from-t.options.min)/(t.options.max-t.options.min),i=(t.selected.to-t.options.min)/(t.options.max-t.options.min),s=e/(1-(i-e));t.body.rail.style.backgroundPosition=`${100*s}% 0`,t.body.rail.style.backgroundSize=`${100*(i-e)}% 100%`},sliders:function(){let e=t._getWidthOf(t.body.sliders.from),i=t._getWidthOf(t.body.sliders.to),s=(t.selected.from-t.options.min)/(t.options.max-t.options.min);s-=e/2;let o=(t.selected.to-t.options.min)/(t.options.max-t.options.min);o-=i/2,t.body.sliders.from.style.left=`${100*s}%`,t.body.sliders.to.style.left=`${100*o}%`},info:function(){t.body.info.min.innerHTML=t._addAffixes(t._getStringWithDecimals(t.options.min),"min"),t.body.info.max.innerHTML=t._addAffixes(t._getStringWithDecimals(t.options.max),"max"),t.body.info.from.innerHTML=t._addAffixes(t._getStringWithDecimals(t.selected.from),"from"),t.body.info.to.innerHTML=t._addAffixes(t._getStringWithDecimals(t.selected.to),"to"),t.body.info.singleFrom.innerHTML=t._addAffixes(t._getStringWithDecimals(t.selected.from),"from"),t.body.info.singleTo.innerHTML=t._addAffixes(t._getStringWithDecimals(t.selected.to),"to"),t.body.info.singleSingle.innerHTML=t._addAffixes(t._getStringWithDecimals(t.selected.to),"single"),t.selected.from==t.selected.to?(t.body.info.singleFrom.style.display="none",t.body.info.singleTo.style.display="none",t.body.info.singleSingle.style.display="inline-block"):(t.body.info.singleFrom.style.display="inline-block",t.body.info.singleTo.style.display="inline-block",t.body.info.singleSingle.style.display="none");let e=t._getWidthOf(t.body.info.from),i=t._getWidthOf(t.body.info.to),s=t._getWidthOf(t.body.info.single),o=t._getCenterOf(t.body.sliders.from)-e/2,n=t._getCenterOf(t.body.sliders.to)-i/2,d=(t._getCenterOf(t.body.sliders.from)+t._getCenterOf(t.body.sliders.to))/2-s/2,l=t._getLeftOf(t.body.parent),r=t._getRightOf(t.body.parent);o<l?o=l:o+e>r&&(o=r-e),n<l?n=l:n+i>r&&(n=r-i),d<l?d=l:d+s>r&&(d=r-s),t.body.info.from.style.left=`${100*o}%`,t.body.info.to.style.left=`${100*n}%`,t.body.info.single.style.left=`${100*d}%`,t._getRightOf(t.body.info.from)>t._getLeftOf(t.body.info.to)?(t.body.info.from.style.visibility="hidden",t.body.info.to.style.visibility="hidden",t.body.info.single.style.visibility="visible"):(t.body.info.from.style.visibility="visible",t.body.info.to.style.visibility="visible",t.body.info.single.style.visibility="hidden"),t._getRightOf(t.body.info.min)>t._getLeftOf(t.body.info.from)||t._getRightOf(t.body.info.min)>t._getLeftOf(t.body.info.single)&&"visible"==t.body.info.single.style.visibility?t.body.info.min.style.visibility="hidden":t.body.info.min.style.visibility="visible",t._getRightOf(t.body.info.to)>t._getLeftOf(t.body.info.max)||t._getRightOf(t.body.info.single)>t._getLeftOf(t.body.info.max)&&"visible"==t.body.info.single.style.visibility?t.body.info.max.style.visibility="hidden":t.body.info.max.style.visibility="visible"},values:function(){t.inputMin.setAttribute("value",t.selected.from),t.inputMax.setAttribute("value",t.selected.to)}}}_addAffixes(t,e){return this.options.prefixes[e]&&(t=this.options.prefixes[e]+t),this.options.suffixes[e]&&(t+=this.options.suffixes[e]),t}_throttle(t,e){return void 0===this.meta.throttle[t]&&(this.meta.throttle[t]=!1),!this.meta.throttle[t]&&(this.meta.throttle[t]=!0,setTimeout(()=>{this.meta.throttle[t]=!1},e),!0)}}