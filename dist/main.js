!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.JSR=e()}(this,function(){"use strict";const t={};function e(e,s,i){return!t[e]&&(t[e]=i,t[e](),setTimeout(()=>{t[e]=!1},s),!0)}function s(t,e,s){t.addEventListener(e,s)}function i(t,e,r){t instanceof Array?t.forEach(t=>{t instanceof Array?i(t,e,r):s(t,e,r)}):s(t,e,r)}function r(t){const e=t.toString().split(".");return e[1]?e[1].length:0}function n(t){const e=this.config.min;return(t-e)/(this.config.max-e)}function o(t){const e=this.config.min,s=this.config.max;return function(t){const e=this.config.step,s=Math.pow(10,this.stepDecimals);return t=Math.round(t/e)*e,Math.round(t*s)/s}.call(this,t=(s-e)*t+e)}var l=function(t,e){const s={};return function t(e,s,i,r){const n=s[e],o=n.count,l=[];if(o<=0)return l;i[e]=i[e]||[];for(let t=0;t<o;t+=1){const t=document.createElement("div");t.classList.add(...n.classes),i[e].push(t),l.push(t)}return n.children.length>0&&n.children.forEach(n=>{for(let l=0;l<o;l+=1)t(n,s,i,r).forEach(t=>{r[n]=void 0===r[n]?0:r[n]+1,t.dataset.jsrId=r[n];for(const e in s[n].attributes)t.setAttribute(e,s[n].attributes[e]);i[e][l].appendChild(t)})}),l}(e,t,s,{}),function(t,e){for(const s in t)1!==t[s].length||e[s].alwaysArray||(t[s]=t[s][0])}(s,t),s};const h={debug:0,info:1,warn:2,error:3,disable:4};var a=function(t){return!!(e=t)&&"object"==typeof e&&function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"!==e&&"[object Date]"!==e}(t);var e};function u(t,e){return e&&!0===e.clone&&a(t)?c((s=t,Array.isArray(s)?[]:{}),t,e):t;var s}function d(t,e,s){var i=t.slice();return e.forEach(function(e,r){void 0===i[r]?i[r]=u(e,s):a(e)?i[r]=c(t[r],e,s):-1===t.indexOf(e)&&i.push(u(e,s))}),i}function c(t,e,s){var i=Array.isArray(e);if(i===Array.isArray(t)){if(i){return((s||{arrayMerge:d}).arrayMerge||d)(t,e,s)}return function(t,e,s){var i={};return a(t)&&Object.keys(t).forEach(function(e){i[e]=u(t[e],s)}),Object.keys(e).forEach(function(r){a(e[r])&&t[r]?i[r]=c(t[r],e[r],s):i[r]=u(e[r],s)}),i}(t,e,s)}return u(e,s)}c.all=function(t,e){if(!Array.isArray(t)||t.length<2)throw new Error("first argument should be an array with at least two elements");return t.reduce(function(t,s){return c(t,s,e)})};var g=c;function m(t,e){this.mergedLabels.push(e),this.labels[t].appendChild(this.labels[e])}function f(){const t=this.labels;(function(){this.mergedLabels.forEach(t=>{this.labelsParent.appendChild(this.labels[t])}),this.mergedLabels=[]}).call(this);let e=0,s=e+1;for(;s<t.length;)t[e].getBoundingClientRect().right+5>=t[s].getBoundingClientRect().left?(m.call(this,e,s),s+=1):(e+=1,s+=1);this.minMax[0].getBoundingClientRect().right+5>=this.labels[0].getBoundingClientRect().left?this.minMax[0].style.opacity="0":this.minMax[0].style.opacity="1",this.labels[this.labels.length-1].getBoundingClientRect().right+5>=this.minMax[1].getBoundingClientRect().left?this.minMax[1].style.opacity="0":this.minMax[1].style.opacity="1"}return class{constructor(t,s={}){const a={log:"error",min:0,max:100,step:1,enabled:!0,limit:{show:!1},modules:{eventizer:class{constructor(){this.store={}}_createNewStore(t){this.store[t]||(this.store[t]=[])}_addListener(t,e){this._createNewStore(t);const s=new class{constructor(t){this.callback=t,this.enabled=!0}disable(){this.enabled=!1}enable(){this.enabled=!0}trigger(...t){this.enabled&&this.callback(...t)}}(e);return this.store[t].push(s),s}_dispatchEvent(t,...e){if(!this.store[t])return!1;const s=this.store[t].length;for(let i=0;i<s;i+=1)this.store[t][i].trigger(...e)}register(t,e){return this._addListener(t,e)}trigger(t,...e){this._dispatchEvent(t,...e)}},core:class{constructor(){this.logger=null,this.config={min:0,max:0,step:0},this.modules={},this.values=[],this.valueInMove=[],this.stepRatio=0,this.stepRatioDecimals=0}_setValue(t,e=null,s=!1){if(!this.config.enabled)return null;e=null===e?function(t){let e=1,s=0;return this.values.forEach((i,r)=>{const n=Math.abs(i-t);n<e&&(s=r,e=n)}),s}.call(this,t):parseInt(e),s&&(t=this.valueInMove[e]+t),null!==this.limit.min&&t<this.limit.min&&(t=this.limit.min),null!==this.limit.max&&t>this.limit.max&&(t=this.limit.max),void 0!==this.values[e-1]&&t<this.values[e-1]&&(t=this.values[e-1]),void 0!==this.values[e+1]&&t>this.values[e+1]&&(t=this.values[e+1]);const i=function(t){const e=this.stepRatio,s=Math.pow(10,this.stepRatioDecimals);return t=Math.round(t/e)*e,Math.round(t*s)/s}.call(this,t);i!==this.values[e]&&(this.values[e]=i,this.modules.renderer.setSliderValue(i,e),this.modules.eventizer.trigger("core/value:update",e,o.call(this,i),i))}_bindEvents(){const t=this.modules.eventizer;t.register("view/slider:mousedown",(t,e)=>{this.logger.debug("JSR: Slider mousedown."),this.logger.debug(t),e.forEach(t=>{this.valueInMove[t]=this.values[t]})}),t.register("view/slider:mousemove",(t,s,i)=>{e("slider-mousemove",10,()=>{this.logger.debug("JSR: Slider mousemove."),this.logger.debug(t),this._setValue(i,s,!0)})}),t.register("view/slider:mouseup",t=>{this.logger.debug("JSR: Slider mouseup."),this.logger.debug(t)}),t.register("view/rail:click",(t,e)=>{this.logger.debug("JSR: Rail clicked."),this.logger.debug(t),this._setValue(e)}),t.register("view/root:arrow",(t,e,s)=>{const i=this.values[e]+(t.shiftKey?.05:t.ctrlKey?10*this.stepRatio:this.stepRatio)*s;this._setValue(i,e)}),t.register("view/bar:mousedown",(t,e)=>{this.logger.debug("JSR: Bar mousedown."),this.logger.debug(t),this.valueInMove[e]=this.values[e],this.valueInMove[e+1]=this.values[e+1]}),t.register("view/bar:mousemove",(t,s,i)=>{e("bar-mousemove",10,()=>{this.logger.debug("JSR: Bar mousemove."),this.logger.debug(t),this._setValue(i,s,!0),this._setValue(i,s+1,!0)})}),t.register("view/bar:mouseup",t=>{this.logger.debug("JSR: Bar mouseup."),this.logger.debug(t)})}build({config:t,modules:e,logger:s}){this.config=t,this.logger=s,this.modules=e,this.limit={},this.setLimit("min",this.config.limit.min,!0),this.setLimit("max",this.config.limit.max,!0),this.stepDecimals=r(this.config.step),this.stepRatio=function(){const t=this.config.min,e=this.config.max;return this.config.step/(e-t)}.call(this),this.stepRatioDecimals=r(this.stepRatio)}init(t,e){this.modules.renderer.appendRoot(t[0]),e.forEach((t,e)=>{t=n.call(this,t),this._setValue(t,e)}),this._bindEvents(),this.logger.info("JSR: Core initiated.")}getValue(t){const e=this.values[t];return o.call(this,e)}setValue(t,e){this._setValue(t,e)}setLimit(t,e,s=!1){if(null===e||void 0===e)this.limit[t]="min"===t?0:1;else{if(this.limit[t]=n.call(this,e),this.limit[t]<0?this.limit[t]=0:this.limit[t]>1&&(this.limit[t]=1),s)return;if(this.values.forEach((t,e)=>{this._setValue(t,e)}),this.config.limit.show){const t=this.modules.renderer.body.limitBar;t.style.left=`${100*this.limit.min}%`,t.style.right=`${100*(1-this.limit.max)}%`}}}},labels:class{constructor(){this.labels=[],this.minMax=[],this.values=[],this.labelsParent=null,this.mergedLabels=[]}_bindEvents(){i(this.labels,"click",t=>{t.stopPropagation()}),this.modules.eventizer.register("core/value:update",(t,e,s)=>{this.values[t]=[e,s],function(t,e,s){const i=this.labels[t];if(this.config.step<1){const t=r(e),s=r(this.config.step)-t;if(s>0){const t=e.toString().split(".");e=`${t[0]}.${t[1]||0}${Array(s).join("0")}`}}i.innerHTML=this.formatter?this.formatter(e):e,this.values[t]=s;let n=i.getBoundingClientRect();i.style.left=`calc(${100*s}% - ${n.width/2}px)`,function(){return this.values.filter(t=>void 0!==t).length===this.config.values.length}.call(this)&&f.call(this);const o=this.modules.renderer.body.root.getBoundingClientRect();(n=i.getBoundingClientRect()).right>o.right&&(i.style.left=`calc(100% - ${n.width}px)`),n.left<o.left&&(i.style.left="0")}.call(this,t,e,s)}),i(this.labels,"mousedown",t=>{const e=new MouseEvent("mousedown",t);this.modules.renderer.body.sliders[t.target.dataset.jsrId].dispatchEvent(e)}),i(window,"resize",()=>{e(`label-update-overlapping-${Math.random()}`,50,()=>{f.call(this)})})}_parseMinMax(){this.minMax[0].innerHTML=this.formatter?this.formatter(this.config.min):this.config.min,this.minMax[1].innerHTML=this.formatter?this.formatter(this.config.max):this.config.max,this.minMax[0].style.left="0%",this.minMax[1].style.right="0%",this.config.labels.minMax||(this.minMax[0].style.display="none",this.minMax[1].style.display="none")}build({config:t,modules:e,logger:s}){const i={labels:{minMax:!0,formatter:null}};this.logger=s,this.config=g(i,t),this.modules=e,this.formatter=this.config.labels.formatter,this.modules.renderer.structure.labels={classes:["jsr_label"],children:[],count:this.config.sliders,alwaysArray:!0},this.modules.renderer.structure.rail.children.push("labels"),this.modules.renderer.structure.labelsMinMax={classes:["jsr_label","jsr_label--minmax"],children:[],count:2},this.modules.renderer.structure.rail.children.push("labelsMinMax"),this.modules.eventizer.register("modules/renderer:builded",()=>{this.labels=this.modules.renderer.body.labels,this.labelsParent=this.labels[0].parentNode,this.minMax=this.modules.renderer.body.labelsMinMax,this._parseMinMax(),this._bindEvents()})}},grid:class{_bindEvents(){const t=Math.random();window.addEventListener("resize",()=>{e(`grid-resize-${t}`,50,()=>{this.logger.debug("JSR: Canvas resized."),this._setWidth(),this._render()})})}_setWidth(){this.canvas.width=this.modules.renderer.body.railOuter.offsetWidth}_getNumberOfLines(){return Math.round(100)}_render(){const t=this.canvas.width,e=this.config.grid.height,s=this.context,i=this._getNumberOfLines(),r=1/i;s.clearRect(0,0,t,e),s.beginPath(),s.lineWidth=1,s.fillStyle=s.strokeStyle=this.config.grid.color,s.font=`${this.config.grid.fontSize}px ${this.config.grid.fontFamily}`,s.textBaseline="top";for(let n=0;n<=i;n+=1){let o=n*r*t;if(o=Math.round(100*o)/100,s.moveTo(o,0),s.lineTo(o,e),n%10==0){s.textAlign=0===n?"left":n===i?"right":"center";let o=(this.config.max-this.config.min)*(n/i)+this.config.min;this.config.labels&&this.config.labels.formatter&&(o=this.config.labels.formatter(o)),s.fillText(o.toString(),n*r*t,e+this.config.grid.textPadding)}}s.closePath(),s.stroke()}build({config:t,modules:e,logger:s}){const i={grid:{color:"rgba(0, 0, 0, 0.3)",height:10,fontSize:10,fontFamily:"sans-serif",textPadding:5}};this.logger=s,this.config=g(i,t),this.modules=e,this.canvas=document.createElement("canvas"),this.canvas.classList.add("jsr_canvas"),this.canvas.height=this.config.grid.height+this.config.grid.fontSize+this.config.grid.textPadding,this.context=this.canvas.getContext("2d"),this.modules.eventizer.register("modules/renderer:rootAppended",()=>{this.modules.renderer.body.railOuter.appendChild(this.canvas),this._setWidth(),this._render()}),this._bindEvents()}},renderer:class{constructor(){this.logger=null,this.config={},this.modules={},this.temp={sliderInMove:null,sliderClickX:0,barInMove:null,barClickX:0},this.values=[],this.body={},this.bodyStructure={root:{classes:["jsr"],children:["railOuter"],count:1},railOuter:{classes:["jsr_rail-outer"],children:["rail"],count:1},rail:{classes:["jsr_rail"],children:["bars","sliders","limitBar"],count:1},sliders:{classes:["jsr_slider"],children:[],attributes:{tabindex:0},count:2,alwaysArray:!0},bars:{classes:["jsr_bar"],children:[],count:1,alwaysArray:!0},limitBar:{classes:["jsr_bar","jsr_bar--limit"],children:[],count:1}}}_bindEvents(){const t=this.modules.eventizer;i(this.body.sliders,"click",t=>{t.stopPropagation()}),i(this.body.sliders,"mousedown",e=>{e.stopPropagation(),this.temp.sliderInMove=parseInt(e.target.dataset.jsrId),this.temp.sliderClickX=e.clientX;const s=function(t){const e=[];return this.values.forEach((s,i)=>{s===this.values[t]&&e.push(i)}),e}.call(this,this.temp.sliderInMove);s.length>1&&(this.temp.sliderInMove=s),t.trigger("view/slider:mousedown",e,s)}),i(document,"mousemove",e=>{if(e.stopPropagation(),null===this.temp.sliderInMove)return;this.temp.sliderInMove instanceof Array&&(e.clientX<this.temp.sliderClickX?this.temp.sliderInMove=this.temp.sliderInMove[0]:this.temp.sliderInMove=this.temp.sliderInMove.pop()),this.body.sliders[this.temp.sliderInMove].focus(),this.body.sliders[this.temp.sliderInMove].classList.add("jsr_slider--active");const s=(e.clientX-this.temp.sliderClickX)/this.body.railOuter.offsetWidth;t.trigger("view/slider:mousemove",e,this.temp.sliderInMove,s)}),i(document,"mouseup",e=>{null!==this.temp.sliderInMove&&(this.body.sliders.forEach(t=>{t.classList.remove("jsr_slider--active")}),t.trigger("view/slider:mouseup",e,this.temp.sliderInMove),this.temp.sliderInMove=null)}),this.body.bars&&(i(this.body.bars,"click",t=>{this.temp.barClickX!==t.clientX&&t.stopPropagation()}),i(this.body.bars,"mousedown",e=>{this.temp.barInMove=parseInt(e.target.dataset.jsrId),this.temp.barClickX=e.clientX,t.trigger("view/bar:mousedown",e,this.temp.barInMove)}),i(document,"mousemove",e=>{if(null===this.temp.barInMove)return;const s=(e.clientX-this.temp.barClickX)/this.body.railOuter.offsetWidth;t.trigger("view/bar:mousemove",e,this.temp.barInMove,s)}),i(document,"mouseup",e=>{null!==this.temp.barInMove&&(t.trigger("view/bar:mouseup",e,this.temp.barInMove),this.temp.barInMove=null)})),i(this.body.railOuter,"click",e=>{const s=(e.clientX-this.body.railOuter.getBoundingClientRect().left)/this.body.railOuter.offsetWidth;t.trigger("view/rail:click",e,s)}),i(this.body.root,"keydown",e=>{const s=e.target.dataset.jsrId,i={37:-1,38:1,39:1,40:-1}[e.keyCode.toString()];if(!i)return!1;e.preventDefault(),t.trigger("view/root:arrow",e,s,i)})}_updateBars(t,e){if(!this.body.bars)return;const s=this.body.bars[t-1],i=this.body.bars[t];s&&(s.style.right=`${100*(1-e)}%`),i&&(i.style.left=`${100*e}%`)}build({modules:t,logger:e,config:s}){this.modules=t,this.logger=e,this.config=s,this.bodyStructure.sliders.count=this.config.sliders||1,this.bodyStructure.bars.count=this.bodyStructure.sliders.count-1,this.body=l(this.bodyStructure,"root"),this._bindEvents(),this.modules.eventizer.trigger("modules/renderer:builded")}get structure(){return this.bodyStructure}appendRoot(t){t.parentNode.insertBefore(this.body.root,t.nextSibling),this.modules.eventizer.trigger("modules/renderer:rootAppended")}setSliderValue(t,e){const s=this.body.sliders[e],i=`${100*t}%`;this.logger.debug(`JSR: Slider no. ${e} set to value: ${t}.`),this.values[e]=t,s.style.left=i,this._updateBars(e,t)}},touchSupport:class{_bindEvents(){const t=[this.modules.renderer.body.sliders];this.modules.renderer.body.labels&&t.push(this.modules.renderer.body.labels),i(t,"touchstart",t=>{document.documentElement.classList.add("jsr_lockscreen"),t=t.targetTouches.item(0);const e=new MouseEvent("mousedown",t);this.modules.renderer.body.sliders[t.target.dataset.jsrId].dispatchEvent(e)}),i(t,"touchmove",t=>{t=t.targetTouches.item(0);const e=new MouseEvent("mousemove",t);document.dispatchEvent(e)}),i(document,"touchend",t=>{document.documentElement.classList.remove("jsr_lockscreen"),t=t.targetTouches.item(0);const e=new MouseEvent("mouseup",t);document.dispatchEvent(e)})}build({config:t,modules:e,logger:s}){this.logger=s,this.config=t,this.modules=e,this._bindEvents()}},inputUpdater:class{constructor(){this.input=null}_bindEvents(){this.modules.eventizer.register("core/value:update",(t,e)=>{this.inputs[t].value=e,this.modules.eventizer.trigger("input/value:update",this.inputs[t],e),this.logger.debug(`JSR: Input ${t} updated with value ${e}`)})}build({config:t,modules:e,logger:s},i){this.inputs=i.inputs,this.logger=s,this.config=t,this.modules=e,this._bindEvents()}},htmlLabels:class{_bindEvents(){this.inputs.map(t=>t.id).forEach((t,e)=>{const s=document.querySelector(`label[for="${t}"]`);s&&s.addEventListener("click",()=>{this.modules.renderer.body.sliders[e].focus()})})}build({config:t,modules:e,logger:s},i){this.logger=s,this.config=t,this.modules=e,this.inputs=i.inputs,this._bindEvents()}}}};this.config=g(a,s,{arrayMerge:(t,e)=>e}),this.specificConfig={inputUpdater:{},htmlLabels:{}},this.logger=new class{constructor(){this.level=1}setLevel(t){this.level=h[t]}debug(...t){this.level>0||console.log(...t)}log(...t){this.level>1||console.log(...t)}info(...t){this.level>1||console.info(...t)}warn(...t){this.level>2||console.warn(...t)}error(...t){this.level>3||console.error(...t)}},this.logger.setLevel(this.config.log),t=[].concat(t),this.inputs=t.map(t=>"string"==typeof t?document.querySelector(t):t);const u=this._validate({inputs:t});if(u)return u.forEach(t=>{this.logger.error(t)}),{};this.modules={};for(const t in this.config.modules)this.config.modules[t]&&(this.modules[t]=new this.config.modules[t]);this.specificConfig.inputUpdater.inputs=this.inputs,this.specificConfig.htmlLabels.inputs=this.inputs,this._buildModules(),this._init()}_validate(t){const e=[];return this.config.sliders!==this.config.values.length&&e.push("JSR: Number of sliders isn't equal to number of values."),this.inputs.length!==this.config.values.length&&e.push("JSR: Number of inputs isn't equal to number of values."),this.inputs.forEach((s,i)=>{s||e.push(`JSR: Input ${t.inputs[i]} not found.`)}),!!e.length&&e}_buildModules(){for(const t in this.modules){const e=this.modules[t].build;e?(e.call(this.modules[t],{modules:this.modules,logger:this.logger,config:this.config},this.specificConfig[t]||{}),this.logger.info(`JSR: Module ${t} builded.`)):this.logger.info(`JSR: Module ${t} skipped. No .build() method.`)}}_init(){this.inputs.forEach(t=>{t.style.display="none"}),this.modules.core.init(this.inputs,this.config.values)}addEventListener(t,e){const s={update:"input/value:update"};return this.modules.eventizer.register(s[t],e),this}setValue(t,e){return this.modules.core.setValue(e,t),this}setLimit(t,e){return this.modules.core.setLimit(t,e),this}disable(){return this.config.enabled=!1,this.modules.renderer.body.root.classList.add("jsr--disabled"),this}enable(){return this.config.enabled=!0,this.modules.renderer.body.root.classList.remove("jsr--disabled"),this}}});
