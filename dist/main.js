var JSR=function(){"use strict";function e(e,t,i){return!x[e]&&(x[e]=i,setTimeout(function(){x[e](),x[e]=!1},t),!0)}function t(e,t,i){e.addEventListener(t,i)}function i(e,n,r){e instanceof Array?e.forEach(function(e){e instanceof Array?i(e,n,r):t(e,n,r)}):t(e,n,r)}function n(e){var t=e.toString().split(".");return t[1]?t[1].length:0}function r(e){var t=this.config.min;return(e-t)/(this.config.max-t)}function s(e){var t=this.config.step,i=Math.pow(10,this.stepDecimals);return e=Math.round(e/t)*t,Math.round(e*i)/i}function o(e){var t=this.config.min;return e=(this.config.max-t)*e+t,s.call(this,e)}function l(){var e=this.config.min,t=this.config.max;return this.config.step/(t-e)}function u(e){var t=this.stepRatio,i=Math.pow(10,this.stepRatioDecimals);return e=Math.round(e/t)*t,Math.round(e*i)/i}function a(e){var t=1,i=0;return this.values.forEach(function(n,r){var s=Math.abs(n-e);s<t&&(i=r,t=s)}),i}function c(e,t,i,n){var r=t[e],s=r.count,o=[];if(s<=0)return o;i[e]=i[e]||[];for(var l=0;l<s;l+=1){var u,a=document.createElement("div");(u=a.classList).add.apply(u,S(r.classes)),i[e].push(a),o.push(a)}return r.children.length>0&&r.children.forEach(function(r){for(var o=0;o<s;o+=1)!function(s){c(r,t,i,n).forEach(function(o){n[r]=void 0===n[r]?0:n[r]+1,o.dataset.jsrId=n[r];for(var l in t[r].attributes)o.setAttribute(l,t[r].attributes[l]);i[e][s].appendChild(o)})}(o)}),o}function d(e,t){for(var i in e)1!==e[i].length||t[i].alwaysArray||(e[i]=e[i][0])}function h(e){var t=this,i=[];return this.values.forEach(function(n,r){n===t.values[e]&&i.push(r)}),i}function f(){return this.values.filter(function(e){return void 0!==e}).length===this.config.values.length}function v(e,t){this.mergedLabels.push(t),this.labels[e].appendChild(this.labels[t])}function g(){var e=this;this.mergedLabels.forEach(function(t){e.labelsParent.appendChild(e.labels[t])}),this.mergedLabels=[]}function m(){var e=this.labels;g.call(this);for(var t=0,i=t+1;i<e.length;)e[t].getBoundingClientRect().right+5>=e[i].getBoundingClientRect().left?(v.call(this,t,i),i+=1):(t+=1,i+=1);this.minMax[0].getBoundingClientRect().right+5>=this.labels[0].getBoundingClientRect().left?this.minMax[0].style.opacity="0":this.minMax[0].style.opacity="1",this.labels[this.labels.length-1].getBoundingClientRect().right+5>=this.minMax[1].getBoundingClientRect().left?this.minMax[1].style.opacity="0":this.minMax[1].style.opacity="1"}function p(e,t,i){var n=this.labels[e];n.innerHTML=this.config.labels.affixes.prefix+t+this.config.labels.affixes.suffix,this.values[e]=i;var r=n.getBoundingClientRect();n.style.left="calc("+100*i+"% - "+r.width/2+"px)",f.call(this)&&m.call(this);var s=this.modules.renderer.body.root.getBoundingClientRect();(r=n.getBoundingClientRect()).right>s.right&&(n.style.left="calc(100% - "+r.width+"px)"),r.left<s.left&&(n.style.left="0")}function b(e){return!!e&&"object"==typeof e}function y(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"!==t&&"[object Date]"!==t}function M(e){return Array.isArray(e)?[]:{}}function k(e,t){return t&&!0===t.clone&&P(e)?E(M(e),e,t):e}function w(e,t,i){var n=e.slice();return t.forEach(function(t,r){void 0===n[r]?n[r]=k(t,i):P(t)?n[r]=E(e[r],t,i):-1===e.indexOf(t)&&n.push(k(t,i))}),n}function _(e,t,i){var n={};return P(e)&&Object.keys(e).forEach(function(t){n[t]=k(e[t],i)}),Object.keys(t).forEach(function(r){P(t[r])&&e[r]?n[r]=E(e[r],t[r],i):n[r]=k(t[r],i)}),n}function E(e,t,i){var n=Array.isArray(t),r=Array.isArray(e),s=i||{arrayMerge:w};return n===r?n?(s.arrayMerge||w)(e,t,i):_(e,t,i):k(t,i)}var x={},I=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},R=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),S=function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)},C=function(){function t(){I(this,t),this.logger=null,this.config={min:0,max:0,step:0},this.modules={},this.values=[],this.valueInMove=[],this.stepRatio=0,this.stepRatioDecimals=0}return R(t,[{key:"_setValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t=null===t?a.call(this,e):parseInt(t),i&&(e=this.valueInMove[t]+e),e<0?e=0:e>1&&(e=1),void 0!==this.values[t-1]&&e<this.values[t-1]&&(e=this.values[t-1]),void 0!==this.values[t+1]&&e>this.values[t+1]&&(e=this.values[t+1]);var n=u.call(this,e);n!==this.values[t]&&(this.values[t]=n,this.modules.renderer.setSliderValue(n,t),this.modules.eventizer.trigger("core/value:update",t,o.call(this,n),n))}},{key:"_bindEvents",value:function(){var t=this,i=this.modules.eventizer;i.register("view/slider:mousedown",function(e,i){t.logger.debug("JSR: Slider mousedown."),t.logger.debug(e),i.forEach(function(e){t.valueInMove[e]=t.values[e]})}),i.register("view/slider:mousemove",function(i,n,r){e("slider-mousemove",10,function(){t.logger.debug("JSR: Slider mousemove."),t.logger.debug(i),t._setValue(r,n,!0)})}),i.register("view/slider:mouseup",function(e){t.logger.debug("JSR: Slider mouseup."),t.logger.debug(e)}),i.register("view/rail:click",function(e,i){t.logger.debug("JSR: Rail clicked."),t.logger.debug(e),t._setValue(i)}),i.register("view/root:arrow",function(e,i,n){var r=t.values[i]+(e.shiftKey?.05:e.ctrlKey?10*t.stepRatio:t.stepRatio)*n;t._setValue(r,i)}),i.register("view/bar:mousedown",function(e,i){t.logger.debug("JSR: Bar mousedown."),t.logger.debug(e),t.valueInMove[i]=t.values[i],t.valueInMove[i+1]=t.values[i+1]}),i.register("view/bar:mousemove",function(i,n,r){e("bar-mousemove",10,function(){t.logger.debug("JSR: Bar mousemove."),t.logger.debug(i),t._setValue(r,n,!0),t._setValue(r,n+1,!0)})}),i.register("view/bar:mouseup",function(e){t.logger.debug("JSR: Bar mouseup."),t.logger.debug(e)})}},{key:"build",value:function(e){var t=e.config,i=e.modules,r=e.logger;this.config=t,this.logger=r,this.modules=i,this.stepDecimals=n(this.config.step),this.stepRatio=l.call(this),this.stepRatioDecimals=n(this.stepRatio)}},{key:"init",value:function(e,t){var i=this;this.modules.renderer.appendRoot(e[0]),t.forEach(function(e,t){e=r.call(i,e),i._setValue(e,t)}),this._bindEvents(),this.logger.info("JSR: Core initiated.")}},{key:"getValue",value:function(e){var t=this.values[e];return o.call(this,t)}},{key:"setValue",value:function(e,t){this._setValue(e,t)}}]),t}(),j=function(e,t){var i={};return c(t,e,i,{}),d(i,e),i},A=function(){function e(){I(this,e),this.logger=null,this.config={},this.modules={},this.temp={sliderInMove:null,sliderClickX:0,barInMove:null,barClickX:0},this.values=[],this.body={},this.bodyStructure={root:{classes:["jsr"],children:["railOuter"],count:1},railOuter:{classes:["jsr_rail-outer"],children:["rail"],count:1},rail:{classes:["jsr_rail"],children:["sliders","bars"],count:1},sliders:{classes:["jsr_slider"],children:[],attributes:{tabindex:0},count:2,alwaysArray:!0},bars:{classes:["jsr_bar"],children:[],count:1,alwaysArray:!0}}}return R(e,[{key:"_bindEvents",value:function(){var e=this,t=this.modules.eventizer;i(this.body.sliders,"click",function(e){e.stopPropagation()}),i(this.body.sliders,"mousedown",function(i){i.stopPropagation(),e.temp.sliderInMove=parseInt(i.target.dataset.jsrId),e.temp.sliderClickX=i.clientX;var n=h.call(e,e.temp.sliderInMove);n.length>1&&(e.temp.sliderInMove=n),t.trigger("view/slider:mousedown",i,n)}),i(document,"mousemove",function(i){if(i.stopPropagation(),null!==e.temp.sliderInMove){e.temp.sliderInMove instanceof Array&&(i.clientX<e.temp.sliderClickX?e.temp.sliderInMove=e.temp.sliderInMove[0]:e.temp.sliderInMove=e.temp.sliderInMove.pop()),e.body.sliders[e.temp.sliderInMove].focus();var n=(i.clientX-e.temp.sliderClickX)/e.body.railOuter.offsetWidth;t.trigger("view/slider:mousemove",i,e.temp.sliderInMove,n)}}),i(document,"mouseup",function(i){null!==e.temp.sliderInMove&&(t.trigger("view/slider:mouseup",i,e.temp.sliderInMove),e.temp.sliderInMove=null)}),this.body.bars&&(i(this.body.bars,"click",function(t){e.temp.barClickX!==t.clientX&&t.stopPropagation()}),i(this.body.bars,"mousedown",function(i){e.temp.barInMove=parseInt(i.target.dataset.jsrId),e.temp.barClickX=i.clientX,t.trigger("view/bar:mousedown",i,e.temp.barInMove)}),i(document,"mousemove",function(i){if(null!==e.temp.barInMove){var n=(i.clientX-e.temp.barClickX)/e.body.railOuter.offsetWidth;t.trigger("view/bar:mousemove",i,e.temp.barInMove,n)}}),i(document,"mouseup",function(i){null!==e.temp.barInMove&&(t.trigger("view/bar:mouseup",i,e.temp.barInMove),e.temp.barInMove=null)})),i(this.body.railOuter,"click",function(i){var n=(i.clientX-e.body.railOuter.getBoundingClientRect().left)/e.body.railOuter.offsetWidth;t.trigger("view/rail:click",i,n)}),i(this.body.root,"keydown",function(e){var i=e.target.dataset.jsrId,n={37:-1,38:1,39:1,40:-1}[e.keyCode.toString()];if(!n)return!1;e.preventDefault(),t.trigger("view/root:arrow",e,i,n)})}},{key:"_updateBars",value:function(e,t){if(this.body.bars){var i=this.body.bars[e-1],n=this.body.bars[e];i&&(i.style.right=100*(1-t)+"%"),n&&(n.style.left=100*t+"%")}}},{key:"build",value:function(e){var t=e.modules,i=e.logger,n=e.config;this.modules=t,this.logger=i,this.config=n,this.bodyStructure.sliders.count=this.config.sliders||1,this.bodyStructure.bars.count=this.bodyStructure.sliders.count-1,this.body=j(this.bodyStructure,"root"),this._bindEvents(),this.modules.eventizer.trigger("modules/renderer:builded")}},{key:"appendRoot",value:function(e){e.parentNode.insertBefore(this.body.root,e.nextSibling)}},{key:"setSliderValue",value:function(e,t){var i=this.body.sliders[t],n=100*e+"%";this.logger.debug("JSR: Slider no. "+t+" set to value: "+e+"."),this.values[t]=e,i.style.left=n,this._updateBars(t,e)}},{key:"structure",get:function(){return this.bodyStructure}}]),e}(),B=function(){function e(t){I(this,e),this.callback=t,this.enabled=!0}return R(e,[{key:"disable",value:function(){this.enabled=!1}},{key:"enable",value:function(){this.enabled=!0}},{key:"trigger",value:function(){this.enabled&&this.callback.apply(this,arguments)}}]),e}(),J=function(){function e(){I(this,e),this.store={}}return R(e,[{key:"_createNewStore",value:function(e){this.store[e]||(this.store[e]=[])}},{key:"_addListener",value:function(e,t){this._createNewStore(e);var i=new B(t);return this.store[e].push(i),i}},{key:"_dispatchEvent",value:function(e){if(!this.store[e])return!1;for(var t=this.store[e].length,i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var s=0;s<t;s+=1){var o;(o=this.store[e][s]).trigger.apply(o,n)}}},{key:"register",value:function(e,t){return this._addListener(e,t)}},{key:"trigger",value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this._dispatchEvent.apply(this,[e].concat(i))}}]),e}(),L={debug:0,info:1,warn:2,error:3,disable:4},X=function(){function e(){I(this,e),this.level=1}return R(e,[{key:"setLevel",value:function(e){this.level=L[e]}},{key:"debug",value:function(){var e;this.level>0||(e=console).log.apply(e,arguments)}},{key:"log",value:function(){var e;this.level>1||(e=console).log.apply(e,arguments)}},{key:"info",value:function(){var e;this.level>1||(e=console).info.apply(e,arguments)}},{key:"warn",value:function(){var e;this.level>2||(e=console).warn.apply(e,arguments)}},{key:"error",value:function(){var e;this.level>3||(e=console).error.apply(e,arguments)}}]),e}(),V=function(){function e(){I(this,e),this.input=null}return R(e,[{key:"_bindEvents",value:function(){var e=this;this.modules.eventizer.register("core/value:update",function(t,i){e.inputs[t].value=i,e.modules.eventizer.trigger("input/value:update",e.inputs[t],i),e.logger.debug("JSR: Input "+t+" updated with value "+i)})}},{key:"build",value:function(e,t){var i=e.config,n=e.modules,r=e.logger;this.inputs=t.inputs,this.logger=r,this.config=i,this.modules=n,this._bindEvents()}}]),e}(),z=function(){function e(){I(this,e),this.labels=[],this.minMax=[],this.values=[],this.labelsParent=null,this.mergedLabels=[]}return R(e,[{key:"_bindEvents",value:function(){var e=this;i(this.labels,"click",function(e){e.stopPropagation()}),this.modules.eventizer.register("core/value:update",function(t,i,n){e.values[t]=[i,n],p.call(e,t,i,n)}),i(this.labels,"mousedown",function(t){var i=new MouseEvent("mousedown",t);e.modules.renderer.body.sliders[t.target.dataset.jsrId].dispatchEvent(i)})}},{key:"_parseMinMax",value:function(){this.minMax[0].innerHTML=this.config.min,this.minMax[1].innerHTML=this.config.max,this.minMax[0].style.left="0%",this.minMax[1].style.right="0%",this.config.labels.minMax||(this.minMax[0].style.display="none",this.minMax[1].style.display="none")}},{key:"build",value:function(e){var t=this,i=e.config,n=e.modules,r=e.logger;this.logger=r,this.config=i,this.modules=n,this.modules.renderer.structure.labels={classes:["jsr_label"],children:[],count:this.config.sliders,alwaysArray:!0},this.modules.renderer.structure.rail.children.push("labels"),this.modules.renderer.structure.labelsMinMax={classes:["jsr_label","jsr_label--minmax"],children:[],count:2},this.modules.renderer.structure.rail.children.push("labelsMinMax"),this.modules.eventizer.register("modules/renderer:builded",function(){t.labels=t.modules.renderer.body.labels,t.labelsParent=t.labels[0].parentNode,t.minMax=t.modules.renderer.body.labelsMinMax,t._parseMinMax(),t._bindEvents()})}}]),e}(),O=function(){function e(){I(this,e)}return R(e,[{key:"_bindEvents",value:function(){var e=this;i([this.modules.renderer.body.sliders,this.modules.renderer.body.labels],"touchstart",function(t){document.documentElement.classList.add("jsr_lockscreen"),t=t.targetTouches.item(0);var i=new MouseEvent("mousedown",t);e.modules.renderer.body.sliders[t.target.dataset.jsrId].dispatchEvent(i)}),i([this.modules.renderer.body.sliders,this.modules.renderer.body.labels],"touchmove",function(e){e=e.targetTouches.item(0);var t=new MouseEvent("mousemove",e);document.dispatchEvent(t)}),i(document,"touchend",function(e){document.documentElement.classList.remove("jsr_lockscreen"),e=e.targetTouches.item(0);var t=new MouseEvent("mouseup",e);document.dispatchEvent(t)})}},{key:"build",value:function(e){var t=this,i=e.config,n=e.modules,r=e.logger;this.logger=r,this.config=i,this.modules=n,this.modules.eventizer.register("modules/renderer:builded",function(){t._bindEvents()})}}]),e}(),P=function(e){return b(e)&&y(e)};E.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce(function(e,i){return E(e,i,t)})};var T=E;return function(){function e(t){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};I(this,e);var r={log:"error",min:0,max:100,step:1,labels:{affixes:{prefix:"",suffix:""},minMax:!0},modules:{eventizer:J,core:C,labels:z,touchSupport:O,renderer:A,inputUpdater:V}};this.config=T(r,n,{arrayMerge:function(e,t){return t}}),this.specificConfig={eventizer:{},core:{},labels:{},renderer:{},inputUpdater:{},touchSupport:{}},this.logger=new X,this.logger.setLevel(this.config.log),t=[].concat(t),this.inputs=t.map(function(e){return document.querySelector(e)});var s=this._validate({inputs:t});if(s)return s.forEach(function(e){i.logger.error(e)}),{};this.modules={};for(var o in this.config.modules)this.modules[o]=new this.config.modules[o];this.specificConfig.inputUpdater.inputs=this.inputs,this._buildModules(),this._init()}return R(e,[{key:"_validate",value:function(e){var t=[];return this.config.sliders!==this.config.values.length&&t.push("JSR: Number of sliders isn't equal to number of values."),this.inputs.length!==this.config.values.length&&t.push("JSR: Number of inputs isn't equal to number of values."),this.inputs.forEach(function(i,n){i||t.push("JSR: Input "+e.inputs[n]+" not found.")}),!!t.length&&t}},{key:"_buildModules",value:function(){for(var e in this.modules){var t=this.modules[e].build;t?(t.call(this.modules[e],{modules:this.modules,logger:this.logger,config:this.config},this.specificConfig[e]),this.logger.info("JSR: Module "+e+" builded.")):this.logger.info("JSR: Module "+e+" skipped. No .build() method.")}}},{key:"_init",value:function(){this.inputs.forEach(function(e){e.style.display="none"}),this.modules.core.init(this.inputs,this.config.values)}},{key:"addEventListener",value:function(e,t){var i={update:"input/value:update"};this.modules.eventizer.register(i[e],t)}},{key:"setValue",value:function(e,t){this.modules.core.setValue(e,t)}}]),e}()}();
